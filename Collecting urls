import json
import os
import requests

# Load your list of extension URLs
with open("extension_urls.json", "r", encoding="utf-8") as f:
    urls = json.load(f)

output_dir = "crx_files"
os.makedirs(output_dir, exist_ok=True)

for url in urls:
    try:
        # Extract extension ID from the URL
        ext_id = url.strip("/").split("/")[-1]
        crx_url = (
            f"https://clients2.google.com/service/update2/crx?"
            f"response=redirect&prodversion=114.0&x=id%3D{ext_id}%26installsource%3Dondemand%26uc"
        )

        file_name = os.path.join(output_dir, f"{ext_id}.crx")
        print(f"Downloading {ext_id}...")

        r = requests.get(crx_url, stream=True, timeout=30)
        r.raise_for_status()
        
        with open(file_name, "wb") as f_out:
            for chunk in r.iter_content(chunk_size=8192):
                if chunk:
                    f_out.write(chunk)

        print(f"Saved: {file_name}")

    except Exception as e:
        print(f"Failed to download {url}: {e}")
